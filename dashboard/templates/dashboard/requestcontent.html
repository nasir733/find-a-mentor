{% extends "dashboard/base.html" %}
{% load static %}
{% block content %}

<style>
</style>
<div class="px-8 py-4 bg-white rounded-md shadow-md lg:px-12 lg:pt-12 lg:pb-12 " style="width:100%">
    <div class="py-4 space-y-1 text-center lg:pb-10 ">
      <h2 class="text-lg font-semibold tracking-wide text-gray-800 md:text-2xl lg:text-3xl ">Request {{content.title}} Content</h2>
      <p class="text-base font-medium text-gray-500">{{content.coursecatergory.skill.name}}</p>
      <!-- <p class="text-base font-medium text-gray-500">&dollar;{{content.price_per_hour}}/per hour</p> -->
    </div>
<form action="{% url 'dashboard:requestcontent' content.id %}" method="post" class="block space-y-6" >
    {% csrf_token %}
    
    <div class="space-y-2">
      <label for="date1" class="block text-sm font-semibold text-gray-500">Your Date</label>
      <input 
       
        type="date"
        id ="date1"
        class="w-full border-gray-300 rounded-md"
        
      />
      <span x-show="errorPasswordRepeat" class="block font-semibold tracking-wide text-red-500 uppercase transition-colors duration-300 text-xxs" x-text="errorPasswordRepeat">&nbsp;</span>
    </div><div id="timemessage"></div>
    <div class="flex justify-center px-4 py-4 space-x-1" id="availablehours">
      <!-- <select name='availablityid' class='custom-select' id='availablityid'>
        <option value=''>Select Available Hours</option>
   
    </select> -->
    <div id="timefields">
      
      <!-- <div class="space-y-2">
        <label for="start_time" class="block text-sm font-semibold text-gray-500">Start Time</label>
        <input 
         
          type="date"
          id ="date1"
          class="w-full border-gray-300 rounded-md"
        />
        <span x-show="errorPasswordRepeat" class="block font-semibold tracking-wide text-red-500 uppercase transition-colors duration-300 text-xxs" x-text="errorPasswordRepeat">&nbsp;</span>
      </div> -->
    </div>
    
    </div>
    
    <div id="timefields">
      
      <!-- <div class="space-y-2">
        <label for="start_time" class="block text-sm font-semibold text-gray-500">Start Time</label>
        <input 
         
          type="date"
          id ="date1"
          class="w-full border-gray-300 rounded-md"
        />
        <span x-show="errorPasswordRepeat" class="block font-semibold tracking-wide text-red-500 uppercase transition-colors duration-300 text-xxs" x-text="errorPasswordRepeat">&nbsp;</span>
      </div> -->
    </div>
    
    
  </form>
  </div>



  <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>

  <script>
    const picker = document.getElementById('date1');
    function checktime(time){
      var date =new Date (new Date().toDateString() + ' ' + time);
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12;
      hours = hours ? hours : 12; // the hour '0' should be '12'
      minutes = minutes < 10 ? '0'+minutes : minutes;
      var strTime = hours + ':' + minutes + ' ' + ampm;
      console.log(strTime);
      return strTime;
      
     
    }
    $(function(){
    var dtToday = new Date();
    
    var month = dtToday.getMonth() + 1;
    var day = dtToday.getDate();
    var year = dtToday.getFullYear();
    if(month < 10)
        month = '0' + month.toString();
    if(day < 10)
        day = '0' + day.toString();
    
    var maxDate = year + '-' + month + '-' + day;

    // or instead:
    // var maxDate = dtToday.toISOString().substr(0, 10);

    $('#date1').attr('min', maxDate);
});
  
picker.addEventListener('input', function(e){
  var mentor_availablity_weekday ="{{mentor_availablity_weekday}}"
  var content_id = "{{content.id}}"

  var date1 = document.getElementById("date1").value;
  var day = new Date(this.value).getUTCDay();
  if(mentor_availablity_weekday.includes(day)){
    console.log("day : ",day);
    e.preventDefault();
    
  }
  $.ajax({
        type:"POST",
        url: `/dashboard/checkworkhours/${content_id}/`,
        data: {
          'weekday': day
        },
        dataType: 'json',
        success: function (response) {
          let final = ""
          let final1 = ""
          let final2 = ""
          if (response.mentor_availablity.length == 0) {
            message = "Mentor Not available on "+response.week+""

            $("#availablehours").html(message);
          }
          else {
              $("#availablehours").html("<select name='availablityid' class='custom-select' id='availablityid'><option value=''>Select Your Time from Available Hours</option></select>");
              for (var key in response.mentor_availablity)
              {
                console.log("day : ",date1);

                console.log(response.mentor_availablity[key])
                  //final="<button type='button'  class='flex items-center justify-center w-50 px-4 py-4 space-x-1 text-sm font-semibold leading-4 text-center transition-colors duration-300 bg-gray-600 rounded-md disabled:cursor-not-allowed disabled:opacity-60 hover:bg-blue-700 text-blue-50'><span>"+checktime(response.mentor_availablity[key].from_hour)+" To "+checktime(response.mentor_availablity[key].to_hour)+" </span></button>" 
                  final ="<option value="+response.mentor_availablity[key].id+">"+checktime(response.mentor_availablity[key].from_hour)+" To "+checktime(response.mentor_availablity[key].to_hour)+" </option>"
                  $("#availablityid").append(final)
                  
              }
                
            //  let final1 = "<div class='space-y-2'><label for='start_time' class='block text-sm font-semibold text-gray-500'>Start Time</label><input type='time' id ='from_hour' class='w-full border-gray-300 rounded-md'/><span x-show='errorPasswordRepeat' class='block font-semibold tracking-wide text-red-500 uppercase transition-colors duration-300 text-xxs' x-text='errorPasswordRepeat'>&nbsp;</span></div><div class='space-y-2'><label for='start_time' class='block text-sm font-semibold text-gray-500'>End Time</label><input type='time' id ='to_hour' class='w-full border-gray-300 rounded-md'/><span x-show='errorPasswordRepeat' class='block font-semibold tracking-wide text-red-500 uppercase transition-colors duration-300 text-xxs' x-text='errorPasswordRepeat'>&nbsp;</span></div><button type='button' onclick='requestmentor()' class='flex items-center justify-center w-50 px-4 py-4 space-x-1 text-sm font-semibold leading-4 text-center transition-colors duration-300 bg-blue-600 rounded-md disabled:cursor-not-allowed disabled:opacity-60 hover:bg-blue-700 text-blue-50'><span>Request Content</span></button>"
            let final1 ="<button type='button' onclick='requestmentor()' class='flex items-center justify-center w-50 px-4 py-4 space-x-1 text-sm font-semibold leading-4 text-center transition-colors duration-300 bg-blue-600 rounded-md disabled:cursor-not-allowed disabled:opacity-60 hover:bg-blue-700 text-blue-50'><span>Request Content</span></button>"
            let final2=" <center><h1>Mentor is only Free During In Theese Times</h1></center>"
             $("#timefields").html(final1)
            $("#timemessage").html(final2)
            }
           
            
        },
        error: function(response){
              console(response);
          }
      });
});
  </script>
  <script>
    function requestmentor(week) {
      var content_id = "{{content.id}}"
      var date1 = document.getElementById("date1").value;
      var availablityid = document.getElementById("availablityid").value;
      console.log(availablityid)
      console.log(date1)
      $.ajax({
        type:"POST",
        url: `/dashboard/requestcontent/${content_id}/`,
        data: {
          'availablityid': availablityid,
          'date': date1,
          'mentor_id': content_id,
        },
        dataType: 'json',
        success: function (response) {
          console.log(response)
          if (response.status == "success") {
            window.location = `/dashboard/content/${content_id}`;
          }
          else {
            alert("Request not sent")
          }
        },
        error: function(response){
              console(response);
          }
      });
    }
  </script>
{% endblock %}