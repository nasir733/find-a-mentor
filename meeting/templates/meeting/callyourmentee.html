{% extends "mentor/base.html" %}
{% load static %}
{% block content %}
{% load static %}

<script src="https://cdn.agora.io/sdk/release/AgoraRTCSDK-3.3.1.js"></script>
<link
rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
crossorigin="anonymous"
/>
<script src="https://cdn.agora.io/sdk/release/AgoraRTCSDK-3.3.1.js"></script>
<link
rel="stylesheet"
type="text/css"
href="{% static 'meeting/index.css' %}"
/>     
<div class="container my-5" id="app">
    <div class="row">
      <div class="col">
        <div class="btn-group" role="group">
          
          <button
            type="button"
            class="btn btn-primary mr-2"

            @click="placeCall('{{mentee.user.id}}','{{mentee.user}}')"
          >
            Call {{ mentee.user.username }}
            <span class="badge badge-light"
              >${ getUserOnlineStatus({{mentee.user.id}})}</span
            >
          </button>

        </div>
      </div>
    </div>

    <div class="row my-5" v-if="incomingCall">
        <div class="col-12">
          <p>Incoming Call From <strong>${ incomingCaller }</strong></p>
          <div class="btn-group" role="group">
            <button
              type="button"
              class="btn btn-danger"
              data-dismiss="modal"
              @click="declineCall"
            >
              Decline
            </button>
            <button
              type="button"
              class="btn btn-success ml-5"
              @click="acceptCall"
            >
              Accept
            </button>
          </div>
        </div>
      </div>


      <section id="video-container" v-if="callPlaced">
        <div id="local-video"></div>
        <div id="remote-video"></div>

        <div class="action-btns">
          <button
            type="button"
            class="btn btn-info"
            @click="handleAudioToggle"
          >
            ${ mutedAudio ? "Unmute" : "Mute" }
          </button>
         
          <button
            type="button"
            class="btn btn-primary mx-4"
            @click="handleVideoToggle"
          >
            ${ mutedVideo ? "ShowVideo" : "HideVideo" }
          </button>

          
          <button type="button" class="btn btn-danger" @click="endCall">
            EndCall
          </button>
        </div>

      </section>
</div>
  <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <script>
      window.pusher = new Pusher("06d07740f1d6ef655ab5", {
        cluster: 'us2',
        authEndpoint: "{% url 'meeting:agora-pusher-auth' %}",
        auth: {
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
          },
        },
      });

      const AUTH_USER = "{{user}}"
      const AUTH_USER_ID =  "{{request.user.id}}"
      const CSRF_TOKEN = "{{ csrf_token }}"
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js""
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="{% static 'meeting/index.js' %}"></script>
{% endblock %}